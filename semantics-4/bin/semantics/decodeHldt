#!/bin/bash

gmtkTriangulate \
    -cppCommandOptions "$CPP_OPTIONS" \
    -strFile $STR_DIR/semantics_dcd.str \
    -outputTri $GEN_DIR/tri/semantics_dcd.str.tri \
    -findBest T -verbosity 10

gmtkViterbiNew \
    -cppCommandOptions "$CPP_OPTIONS" \
    -strFile $STR_DIR/semantics_dcd.str \
    -inputMasterFile $MSTR_DCD_DIR/in.mstr \
    -of1 $DATA_HLDT/heldout.list -nf1 0 -ni1 1 -fmt1 ascii \
    -of2 $DATA_HLDT/heldout.2.list -nf2 0 -ni2 2 -fmt2 ascii \
    -triFile $GEN_DIR/tri/semantics_dcd.str.tri \
    -dumpNames $MSTR_DCD_DIR/dump.list \
    -ofilelist $DATA_HLDT/dcd_hldt.list \
    -verbosity 10 \
    -ckbeam 10000

$SRC_DIR/extractDcd.py \
    --dirDcd=$DCD_HLDT/dcd \
    --dirObs=$DATA_HLDT/ho \
    --conceptMap=$CONCEPT_MAP \
    --wordMap=$S1_MAP

$SRC_DIR/extractSmntcs.py --dirCmb=$DCD_HLDT/dcd \
    --dirSmntcs=$DCD_HLDT/dcd \
    --outputMlf=$DCD_HLDT/semantics.mlf 

$SRC_DIR/extractSmntcs.py --dirCmb=$DCD_HLDT/dcd \
    --dirSmntcs=$DCD_HLDT/dcd \
    --lemmatized \
    --outputMlf=$DCD_HLDT/semantics.lemma.mlf 

printSettings > $DCD_HLDT/results.txt

if [ x"$SRESULTS_ONLY" != x ]; then
    ONLY="--only=$SRESULTS_ONLY"
fi
if [ x"$SRESULTS_SKIP" != x ]; then
    SKIP="--skip=$SRESULTS_SKIP"
fi
cdc-treedist.py sresults $DATA_HLDT/semantics.mlf $DCD_HLDT/semantics.mlf $ONLY $SKIP >> $DCD_HLDT/results.txt

$SRC_DIR/cuedSemScore.pl $DCD_HLDT/semantics.mlf.cued $DATA_HLDT/semantics.mlf.cued >> $DCD_HLDT/results.txt

exit 0
