#!/bin/bash

gmtkTriangulate \
    -cppCommandOptions "$CPP_OPTIONS" \
    -strFile $STR_DIR/semantics_dcd.str \
    -outputTri $GEN_DIR/tri/semantics_dcd.str.tri \
    -findBest T -verbosity 10

gmtkViterbiNew \
    -cppCommandOptions "$CPP_OPTIONS" \
    -strFile $STR_DIR/semantics_dcd.str \
    -inputMasterFile $MSTR_DCD_DIR/in.mstr \
    -of1 $DATA_TST/test.list -nf1 0 -ni1 1 -fmt1 ascii \
    -of2 $DATA_TST/test.2.list -nf2 0 -ni2 2 -fmt2 ascii \
    -triFile $GEN_DIR/tri/semantics_dcd.str.tri \
    -dumpNames $MSTR_DCD_DIR/dump.list \
    -ofilelist $DATA_TST/dcd_tst.list \
    -verbosity 10 \
    -ckbeam 10000

$SRC_DIR/extractDcd.py \
    --dirDcd=$DCD_TST/dcd \
    --dirObs=$DATA_TST/ho \
    --conceptMap=$CONCEPT_MAP \
    --wordMap=$S1_MAP

$SRC_DIR/extractSmntcs.py --dirCmb=$DCD_TST/dcd \
    --dirSmntcs=$DCD_TST/dcd \
    --outputMlf=$DCD_TST/semantics.mlf 

$SRC_DIR/extractSmntcs.py --dirCmb=$DCD_TST/dcd \
    --dirSmntcs=$DCD_TST/dcd \
    --lemmatized \
    --outputMlf=$DCD_TST/semantics.lemma.mlf 

printSettings > $DCD_TST/results.txt
if [ x"$SRESULTS_ONLY" != x ]; then
    ONLY="--only=$SRESULTS_ONLY"
fi
if [ x"$SRESULTS_SKIP" != x ]; then
    SKIP="--skip=$SRESULTS_SKIP"
fi
cdc-treedist.py sresults $DATA_TST/semantics.mlf $DCD_TST/semantics.mlf $ONLY $SKIP >> $DCD_TST/results.txt

$SRC_DIR/cuedSemScore.pl $DCD_TST/semantics.mlf.cued $DATA_TST/semantics.mlf.cued >> $DCD_TST/results.txt

